import { Meta, Controls, Primary, ArgTypes, Canvas } from '@storybook/blocks';
import { CssVariables } from '@doc-components';
import css from '@digdir/designsystemet-css/error-summary.css?inline';
import * as ErrorSummaryStories from './ErrorSummary.stories';

import { ErrorSummary } from './';

<Meta of={ErrorSummaryStories} />

# ErrorSummary

`ErrorSummary` är en sammanfattning av fel. Det ger användaren en översikt över fel eller
brister som måste åtgärdas på en sida eller ett steg för att gå vidare.

<Primary />
<Controls />

## Så använder du `ErrorSummary`

`ErrorSummary` är obligatorisk för att få rätt aria-attribut (`aria-labelledby`, `role='alert'`, osv.).
Alla `ErrorSummary.Item` måste ha en `href` för att kunna navigera till rätt plats i formuläret.

```tsx
import { ErrorSummary } from '@digdir/designsystemet-react';

<ErrorSummary>
  <ErrorSummary.Heading>Rubrik</ErrorSummary.Heading>
  <ErrorSummary.List>
    <ErrorSummary.Item href='#'>Objekt</ErrorSummary.Item>
  </ErrorSummary.List>
</ErrorSummary>
```

## Exempel

### Använd med textfält

<Canvas of={ErrorSummaryStories.WithForm} />

### aria-role='alert'

`ErrorSummary` har `aria-role='alert'` som standard. Detta innebär att skärmläsare automatiskt läser upp innehållet i `ErrorSummary`.
Det är fortfarande viktigt att `ErrorSummary` får fokus vid inskickning så att användaren blir uppmärksammad på att det finns fel eller brister i formuläret.

<Canvas of={ErrorSummaryStories.ShowHide} />

## Riktlinjer

`ErrorSummary` används för att visa en sammanfattning när det finns fel eller brister i något som användaren har gjort. En sammanfattning kan gälla för ett eller flera fel.

**Se till att**
- användarna kan gå direkt till felen de behöver åtgärda, och att fokus flyttas dit
- rubriken “För att gå vidare måste du rätta till följande fel” används
- länkarna i sammanfattningen överensstämmer med felmeddelandena de länkar till

<br/>

### Placering

Vi rekommenderar att visa `ErrorSummary` precis ovanför Nästa/Skicka in-knappen. Detta för 
att användarna ska förstå sambandet mellan felet och varför de hindras från att gå vidare.

I vissa fall kan det ändå vara bättre att visa sammanfattningen högst upp, vilket du kan läsa mer om i [artikeln om felmeddelanden](https://designsystemet.no/monstre/feilmeldinger#oppsummering-av-flere-feilmeldinger).

`ErrorSummary` ska innehålla alla felmeddelanden på sidan så att användarna kan navigera direkt 
till felen och bristerna.

Det ska finnas länkar från `ErrorSummary` till där felet är på sidan. När användaren klickar på en av länkarna,
ska fokus flyttas till där felet är.

Länktexten i `ErrorSummary` måste vara identisk med felet den länkar till.

<br/>

### Synlighet

Sammanfattningen ska inte vara synlig utan att användaren gör något. Den ska visas först när användaren har utfört en åtgärd som utlöser fel.

- Om vi validerar löpande (t.ex. vid `onBlur` på varje fält), väntar vi med att visa ErrorSummary tills användaren försöker skicka in formuläret.
- Det är viktigt att komponenten får fokus när den visas så att användaren blir medveten om att det finns fel eller brister i formuläret.
- Felmeddelandena i sammanfattningen ska vara formulerade likadant som felmeddelandet vid fältet.
- Felmeddelandena ska länka direkt till fältet de gäller.
- Om felet gäller flera fält, länkar vi till det första tillfället av felet.

<br/>

## Tillgänglighet

`ErrorSummary` har `aria-role='alert'` som standard. Detta innebär att skärmläsare automatiskt läser upp innehållet i `ErrorSummary` när det visas.
Alla punkter i listan är länkar och beter sig som en länk.

**Se till att**
- När sammanfattningen blir synlig flyttas fokus dit
- När användaren klickar på en länk flyttas fokus till platsen där felet eller bristen uppstod

<br />

### `ErrorSummary.Item`

<ArgTypes of={ErrorSummary.Item} />


## CSS Variabler

<CssVariables css={css} />
